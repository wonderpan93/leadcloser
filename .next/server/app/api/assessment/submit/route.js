(()=>{var e={};e.id=843,e.ids=[843],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},17203:(e,s,t)=>{"use strict";t.r(s),t.d(s,{patchFetch:()=>w,routeModule:()=>l,serverHooks:()=>y,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>m});var r={};t.r(r),t.d(r,{POST:()=>d});var n=t(43007),a=t(44360),i=t(98343),o=t(28142),u=t(21254),c=t(43305);async function d(e){try{let s=await (0,u.th)();if(!s)return o.NextResponse.json({success:!1,message:"Authentication required"},{status:401});let{answers:t}=await e.json();if(!t)return o.NextResponse.json({success:!1,message:"Assessment answers are required"},{status:400});let r=await (0,c.Ei)({userId:s.id,answers:JSON.stringify(t),completed:!0});return o.NextResponse.json({success:!0,message:"Assessment submitted successfully",assessmentId:r.id})}catch(e){return console.error("Assessment submission error:",e),o.NextResponse.json({success:!1,message:"An error occurred while submitting the assessment"},{status:500})}}let l=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/assessment/submit/route",pathname:"/api/assessment/submit",filename:"route",bundlePath:"app/api/assessment/submit/route"},resolvedPagePath:"D:\\leadcloser\\leadcloser\\src\\app\\api\\assessment\\submit\\route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:p,workUnitAsyncStorage:m,serverHooks:y}=l;function w(){return(0,i.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:m})}},21254:(e,s,t)=>{"use strict";t.d(s,{CF:()=>c,Er:()=>u,Ey:()=>d,VX:()=>p,th:()=>m});var r=t(80178),n=t(48361),a=t(53943);t(28142);var i=t(42687);let o=new TextEncoder().encode(process.env.JWT_SECRET||"leadcloser-default-secret-key-change-in-production");async function u(e){return await (0,i.hash)(e,10)}async function c(e,s){return await (0,i.verify)(e,s)}async function d(e){return await new r.P({id:e.id,email:e.email,name:e.name,role:e.role}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("7d").sign(o)}async function l(e){try{let{payload:s}=await (0,n.V)(e,o);return s}catch(e){return null}}function p(e,s){e.cookies.set({name:"auth-token",value:s,httpOnly:!0,secure:!0,sameSite:"strict",maxAge:604800,path:"/"})}async function m(){let e=(0,a.UL)(),s=e.get("auth-token")?.value;return s?await l(s):null}},24467:()=>{},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},42687:e=>{"use strict";e.exports=require("@node-rs/bcrypt")},43305:(e,s,t)=>{"use strict";async function r(e){let{env:s}=process,t=s.DB,r=crypto.randomUUID(),a=new Date().toISOString();try{await t.prepare("INSERT INTO assessments (id, userId, answers, completed, createdAt, updatedAt) VALUES (?, ?, ?, ?, ?, ?)").bind(r,e.userId,e.answers,+!!e.completed,a,a).run();let s=await n(r);if(!s)throw Error("Failed to create assessment");return s}catch(e){throw console.error("Error creating assessment:",e),e}}async function n(e){let{env:s}=process,t=s.DB;try{let s=await t.prepare("SELECT * FROM assessments WHERE id = ?").bind(e).first();return s?{...s,completed:!!s.completed}:null}catch(e){return console.error("Error getting assessment by ID:",e),null}}async function a(e){let{env:s}=process,t=s.DB;try{let s=await t.prepare("SELECT * FROM assessments WHERE userId = ? ORDER BY createdAt DESC LIMIT 1").bind(e).first();return s?{...s,completed:!!s.completed}:null}catch(e){return console.error("Error getting latest assessment for user:",e),null}}t.d(s,{Ei:()=>r,ab:()=>a})},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},61419:()=>{},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[535,38,956],()=>t(17203));module.exports=r})();