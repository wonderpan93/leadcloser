(()=>{var e={};e.id=758,e.ids=[758],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},21254:(e,r,t)=>{"use strict";t.d(r,{CF:()=>c,Er:()=>u,Ey:()=>l,VX:()=>p,th:()=>m});var s=t(80178),a=t(48361),n=t(53943);t(28142);var i=t(42687);let o=new TextEncoder().encode(process.env.JWT_SECRET||"leadcloser-default-secret-key-change-in-production");async function u(e){return await (0,i.hash)(e,10)}async function c(e,r){return await (0,i.verify)(e,r)}async function l(e){return await new s.P({id:e.id,email:e.email,name:e.name,role:e.role}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("7d").sign(o)}async function d(e){try{let{payload:r}=await (0,a.V)(e,o);return r}catch(e){return null}}function p(e,r){e.cookies.set({name:"auth-token",value:r,httpOnly:!0,secure:!0,sameSite:"strict",maxAge:604800,path:"/"})}async function m(){let e=(0,n.UL)(),r=e.get("auth-token")?.value;return r?await d(r):null}},24467:()=>{},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31418:(e,r,t)=>{"use strict";async function s(e){let{env:r}=process,t=r.DB;try{return await t.prepare("SELECT * FROM users WHERE email = ?").bind(e).first()||null}catch(e){return console.error("Error getting user by email:",e),null}}async function a(e){let{env:r}=process,t=r.DB;try{return await t.prepare("SELECT * FROM users WHERE id = ?").bind(e).first()||null}catch(e){return console.error("Error getting user by ID:",e),null}}async function n(e){let{env:r}=process,t=r.DB,s=crypto.randomUUID(),n=new Date().toISOString();try{await t.prepare("INSERT INTO users (id, email, name, passwordHash, role, createdAt, updatedAt) VALUES (?, ?, ?, ?, ?, ?, ?)").bind(s,e.email,e.name,e.passwordHash,e.role,n,n).run();let r=await a(s);if(!r)throw Error("Failed to create user");return r}catch(e){throw console.error("Error creating user:",e),e}}t.d(r,{ht:()=>s,kg:()=>n})},42687:e=>{"use strict";e.exports=require("@node-rs/bcrypt")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},61419:()=>{},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")},84355:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>w,routeModule:()=>m,serverHooks:()=>y,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>h});var s={};t.r(s),t.d(s,{POST:()=>p,dynamic:()=>l,runtime:()=>d});var a=t(43007),n=t(44360),i=t(98343),o=t(28142),u=t(21254),c=t(31418);let l="force-dynamic",d="nodejs";async function p(e){try{let{email:r,password:t}=await e.json();if(!r||!t)return o.NextResponse.json({success:!1,message:"Email and password are required"},{status:400});let s=await (0,c.ht)(r);if(!s||!await (0,u.CF)(t,s.passwordHash))return o.NextResponse.json({success:!1,message:"Invalid email or password"},{status:401});let a=await (0,u.Ey)({id:s.id,email:s.email,name:s.name,role:s.role}),n=o.NextResponse.json({success:!0,message:"Login successful",user:{id:s.id,email:s.email,name:s.name,role:s.role}});return(0,u.VX)(n,a),n}catch(e){return console.error("Login error:",e),o.NextResponse.json({success:!1,message:"An error occurred during login"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"D:\\leadcloser\\leadcloser\\src\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:g,workUnitAsyncStorage:h,serverHooks:y}=m;function w(){return(0,i.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:h})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[535,38,956],()=>t(84355));module.exports=s})();