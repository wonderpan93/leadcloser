(()=>{var e={};e.id=299,e.ids=[299],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},21254:(e,t,r)=>{"use strict";r.d(t,{CF:()=>l,Er:()=>c,Ey:()=>u,VX:()=>m,th:()=>p});var n=r(80178),a=r(48361),s=r(53943);r(28142);var o=r(42687);let i=new TextEncoder().encode(process.env.JWT_SECRET||"leadcloser-default-secret-key-change-in-production");async function c(e){return await (0,o.hash)(e,10)}async function l(e,t){return await (0,o.verify)(e,t)}async function u(e){return await new n.P({id:e.id,email:e.email,name:e.name,role:e.role}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("7d").sign(i)}async function d(e){try{let{payload:t}=await (0,a.V)(e,i);return t}catch(e){return null}}function m(e,t){e.cookies.set({name:"auth-token",value:t,httpOnly:!0,secure:!0,sameSite:"strict",maxAge:604800,path:"/"})}async function p(){let e=(0,s.UL)(),t=e.get("auth-token")?.value;return t?await d(t):null}},24467:()=>{},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},42145:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>E,routeModule:()=>y,serverHooks:()=>v,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>M});var n={};r.r(n),r.d(n,{GET:()=>h,POST:()=>f,dynamic:()=>p,runtime:()=>g});var a=r(43007),s=r(44360),o=r(98343),i=r(28142),c=r(21254),l=r(43305);async function u(e){let{env:t}=process,r=t.DB,n=crypto.randomUUID(),a=new Date().toISOString(),s=e.status||"new";try{await r.prepare(`INSERT INTO leads (
          id, userId, linkedinId, name, title, company, industry, 
          score, scoreBreakdown, engagementLevel, roleRelevance, 
          connectionProximity, activityRecency, contentAlignment,
          profileUrl, notes, status, createdAt, updatedAt
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`).bind(n,e.userId,e.linkedinId||null,e.name,e.title||null,e.company||null,e.industry||null,e.score,JSON.stringify(e.scoreBreakdown),e.scoreBreakdown.engagementLevel,e.scoreBreakdown.roleRelevance,e.scoreBreakdown.connectionProximity,e.scoreBreakdown.activityRecency,e.scoreBreakdown.contentAlignment,e.profileUrl||null,e.notes||null,s,a,a).run();let t=await d(n);if(!t)throw Error("Failed to create lead");return t}catch(e){throw console.error("Error creating lead:",e),e}}async function d(e){let{env:t}=process,r=t.DB;try{let t=await r.prepare("SELECT * FROM leads WHERE id = ?").bind(e).first();if(!t)return null;return{...t,scoreBreakdown:JSON.parse(t.scoreBreakdown)}}catch(e){return console.error("Error getting lead by ID:",e),null}}async function m(e,t=50,r=0){let{env:n}=process,a=n.DB;try{return(await a.prepare("SELECT * FROM leads WHERE userId = ? ORDER BY score DESC LIMIT ? OFFSET ?").bind(e,t,r).all()).results.map(e=>({...e,scoreBreakdown:JSON.parse(e.scoreBreakdown)}))}catch(e){return console.error("Error getting leads for user:",e),[]}}let p="force-dynamic",g="nodejs";async function h(e){try{let t=await (0,c.th)();if(!t)return i.NextResponse.json({success:!1,message:"Authentication required"},{status:401});let{searchParams:r}=new URL(e.url),n=parseInt(r.get("limit")||"20",10),a=parseInt(r.get("offset")||"0",10),s=await m(t.id,n,a);return i.NextResponse.json({success:!0,leads:s})}catch(e){return console.error("Get leads error:",e),i.NextResponse.json({success:!1,message:"An error occurred while fetching leads"},{status:500})}}async function f(e){try{let e=await (0,c.th)();if(!e)return i.NextResponse.json({success:!1,message:"Authentication required"},{status:401});let t=await (0,l.ab)(e.id);if(!t||!t.completed)return i.NextResponse.json({success:!1,message:"Please complete the assessment first"},{status:400});let r=JSON.parse(t.answers),n=(function(e,t){let r=[],n=["Technology","Finance","Healthcare","Education","Manufacturing","Retail","Marketing","Consulting","Real Estate","Nonprofit"],a=["CEO","CTO","CFO","CMO","COO","VP of Sales","Director of Marketing","Product Manager","Consultant","Founder"],s=["Acme Inc","TechCorp","Global Solutions","Innovative Systems","Strategic Partners","NextGen Technologies","Premier Services","Elite Consulting","Visionary Group","Apex Solutions"],o=["solo","micro","small","medium","large","enterprise"],i=["Innovation","Leadership","Marketing","Productivity","Finance","Sustainability","Industry News","Professional Development","Entrepreneurship"],c=["Time Management","Cost Reduction","Quality Improvement","Growth Strategies","Customer Retention","Competitive Analysis","Digital Transformation","Talent Acquisition","Regulatory Compliance"];for(let e=0;e<20;e++){let t=new Date;t.setDate(t.getDate()-Math.floor(180*Math.random())),r.push({linkedinId:`linkedin-${e}`,name:`Lead Candidate ${e+1}`,title:a[Math.floor(Math.random()*a.length)],company:s[Math.floor(Math.random()*s.length)],industry:n[Math.floor(Math.random()*n.length)],companySize:o[Math.floor(Math.random()*o.length)],connectionDegree:Math.floor(3*Math.random())+1,mutualConnections:Math.floor(20*Math.random()),lastActivityDate:t.toISOString(),profileUpdatedRecently:Math.random()>.5,recentJobChange:Math.random()>.7,interests:Array.from({length:Math.floor(5*Math.random())+1},()=>i[Math.floor(Math.random()*i.length)]),mentionedTopics:Array.from({length:Math.floor(3*Math.random())+1},()=>c[Math.floor(Math.random()*c.length)]),engagementMetrics:{postEngagements:Math.floor(10*Math.random()),contentCreated:Math.floor(5*Math.random()),groupActivity:Math.floor(5*Math.random()),comments:Math.floor(10*Math.random()),eventAttendance:Math.floor(3*Math.random())},profileUrl:`https://linkedin.com/in/lead-candidate-${e+1}`})}return r})(0,0).map(t=>(function(e,t,r){var n,a;let s;let o={engagementLevel:(n=e,a=0,s=0,n.engagementMetrics.postEngagements>5?s+=20:n.engagementMetrics.postEngagements>0&&(s+=10),n.engagementMetrics.contentCreated>3?s+=25:n.engagementMetrics.contentCreated>0&&(s+=15),n.engagementMetrics.groupActivity>3?s+=20:n.engagementMetrics.groupActivity>0&&(s+=10),n.engagementMetrics.comments>5?s+=20:n.engagementMetrics.comments>0&&(s+=10),n.engagementMetrics.eventAttendance>0&&(s+=15),Math.min(100,s)),roleRelevance:function(e,t){let r=0,n=t.decision_maker||[];if(Array.isArray(n)&&n.length>0){let t=e.title?.toLowerCase()||"";n.some(e=>t.includes(e)||"ceo"===e&&(t.includes("chief executive")||t.includes("founder")||t.includes("owner"))||"cto"===e&&(t.includes("chief technical")||t.includes("technical director"))||"cfo"===e&&(t.includes("chief financial")||t.includes("finance director"))||"cmo"===e&&(t.includes("chief marketing")||t.includes("marketing director"))||"coo"===e&&(t.includes("chief operating")||t.includes("operations director"))||"vp"===e&&(t.includes("vice president")||t.includes("vp")||t.includes("senior vice"))||"director"===e&&(t.includes("director")||t.includes("head of"))||"manager"===e&&(t.includes("manager")||t.includes("lead"))||"consultant"===e&&(t.includes("consultant")||t.includes("specialist")))?r+=50:n.some(e=>t.includes(e.substring(0,3)))&&(r+=25)}let a=t.industry||"";a&&e.industry&&e.industry.toLowerCase()===a.toLowerCase()&&(r+=30);let s=t.company_size||"";return s&&e.companySize&&e.companySize===s&&(r+=20),Math.min(100,r)}(e,t),connectionProximity:function(e,t){let r=0;switch(e.connectionDegree){case 1:r+=70;break;case 2:r+=50;break;case 3:r+=30;break;default:r+=10}return e.mutualConnections>10?r+=30:e.mutualConnections>5?r+=20:e.mutualConnections>0&&(r+=10),Math.min(100,r)}(e,0),activityRecency:function(e){let t=0,r=new Date,n=new Date(e.lastActivityDate),a=Math.floor((r.getTime()-n.getTime())/864e5);return a<7?t+=100:a<30?t+=75:a<90?t+=50:a<180?t+=25:t+=10,e.profileUpdatedRecently&&(t+=20),e.recentJobChange&&(t+=30),Math.min(100,t)}(e),contentAlignment:function(e,t){let r=0,n=t.interests||[];Array.isArray(n)&&n.length>0&&e.interests&&(r+=Math.min(80,n.filter(t=>e.interests.some(e=>e.toLowerCase().includes(t.toLowerCase()))).length/n.length*100));let a=t.pain_points||[];return Array.isArray(a)&&a.length>0&&e.mentionedTopics&&(r+=20*a.filter(t=>e.mentionedTopics.some(e=>e.toLowerCase().includes(t.toLowerCase()))).length),Math.min(100,r)}(e,t)},i=Math.round(.3*o.engagementLevel+.25*o.roleRelevance+.2*o.connectionProximity+.15*o.activityRecency+.1*o.contentAlignment);return{...e,score:i,scoreBreakdown:o}})(t,r,e));n.sort((e,t)=>t.score-e.score);let a=await Promise.all(n.map(t=>u({userId:e.id,linkedinId:t.linkedinId,name:t.name,title:t.title,company:t.company,industry:t.industry,score:t.score,scoreBreakdown:t.scoreBreakdown,profileUrl:t.profileUrl,status:"new"})));return i.NextResponse.json({success:!0,message:"Leads generated successfully",leads:a})}catch(e){return console.error("Generate leads error:",e),i.NextResponse.json({success:!1,message:"An error occurred while generating leads"},{status:500})}}let y=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/leads/route",pathname:"/api/leads",filename:"route",bundlePath:"app/api/leads/route"},resolvedPagePath:"D:\\leadcloser\\leadcloser\\src\\app\\api\\leads\\route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:w,workUnitAsyncStorage:M,serverHooks:v}=y;function E(){return(0,o.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:M})}},42687:e=>{"use strict";e.exports=require("@node-rs/bcrypt")},43305:(e,t,r)=>{"use strict";async function n(e){let{env:t}=process,r=t.DB,n=crypto.randomUUID(),s=new Date().toISOString();try{await r.prepare("INSERT INTO assessments (id, userId, answers, completed, createdAt, updatedAt) VALUES (?, ?, ?, ?, ?, ?)").bind(n,e.userId,e.answers,+!!e.completed,s,s).run();let t=await a(n);if(!t)throw Error("Failed to create assessment");return t}catch(e){throw console.error("Error creating assessment:",e),e}}async function a(e){let{env:t}=process,r=t.DB;try{let t=await r.prepare("SELECT * FROM assessments WHERE id = ?").bind(e).first();return t?{...t,completed:!!t.completed}:null}catch(e){return console.error("Error getting assessment by ID:",e),null}}async function s(e){let{env:t}=process,r=t.DB;try{let t=await r.prepare("SELECT * FROM assessments WHERE userId = ? ORDER BY createdAt DESC LIMIT 1").bind(e).first();return t?{...t,completed:!!t.completed}:null}catch(e){return console.error("Error getting latest assessment for user:",e),null}}r.d(t,{Ei:()=>n,ab:()=>s})},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},61419:()=>{},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[535,38,956],()=>r(42145));module.exports=n})();